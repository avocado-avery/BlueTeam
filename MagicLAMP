#!/bin/bash

# Function to detect the OS and package manager
detect_os() {
    if [ -f /etc/os-release ]; then
        . /etc/os-release
        OS="$ID"
    fi
}

# Function to install packages
install_packages() {
    detect_os
    case "$OS" in
        ubuntu|debian)
            export DEBIAN_FRONTEND=noninteractive
            apt-get -o DPkg::Lock::Timeout=-1 -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" install -qq -y "$@"
            ;;
        rhel|centos|fedora|rocky)
            yum install -y "$@"
            ;;
        *)
            echo "Unsupported OS"
            exit 1
            ;;
    esac
}

translate_packages() {
    detect_os
    case "$OS" in
        ubuntu|debian)
            install_packages apache2 mariadb-server php libapache2-mod-php php-curl php-intl php-gd php-json php-mbstring php-xml php-zip php-bcmath php-mysql php-imagick
            ;;
        rhel|centos|fedora|rocky)
            install_packages httpd mariadb-server php php-mysqlnd php-gd php-mbstring php-intl php-pecl-imagick php-opcache php-xml php-json php-bcmath php-pecl-zip
            ;;
        *)
}

detect_os
install_packages
translate_packages

install_cms() {
    CMS_NAME=$1
    CMS_URL=$2
    CMS_DIR="/var/www/html/$CMS_NAME"
    mkdir -p "$CMS_DIR"
    curl -sL "$CMS_URL" | tar -xz -C "$CMS_DIR" --strip-components=1
    chmod -R 755 "$CMS_DIR"
    detect_os
    case "$OS" in
        ubuntu|debian)
            chown -R www-data:www-data "$CMS_DIR"
            ;;
        rhel|centos|fedora|rocky)
            chown -R apache:apache "$CMS_DIR"
            ;;
        *)
}

case "$1" in
    --presta)
        install_cms "prestashop" "https://github.com/PrestaShop/PrestaShop/releases/latest/download/prestashop.zip"
        ;;
    --commerce)
        install_cms "oscommerce" "https://github.com/osCommerce/oscommerce2/archive/master.tar.gz"
        ;;
    --zen)
        install_cms "zencart" "https://github.com/zencart/zencart/archive/master.tar.gz"
        ;;
    *)
        echo "Usage: $0 [--presta | --commerce | --zen]"
        exit 1
        ;;
esac

